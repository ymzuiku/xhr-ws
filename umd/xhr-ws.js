!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).HttpWs={})}(this,function(e){"use strict";function t(a,c){return function(u){return new Promise(function(t){var e=c||{},n=e.headers,r=e.timeout,o=void 0===r?4e3:r,i=new XMLHttpRequest;function s(e){e&&e.target?t(e.target.response):t({error:"XMLHttpRequest callback is error"})}i.addEventListener("load",s),i.addEventListener("error",s),i.addEventListener("timeour",function(){t({error:"time out: "+o+"ms",url:a})}),i.open("POST",a,!0),i.timeout=o,i.responseType="json",i.setRequestHeader("content-type","application/json"),n&&Object.keys(n).forEach(function(e){i.setRequestHeader(e,n[e])}),i.send(JSON.stringify(u))})}}function n(e){var i,s=0,u={};function a(){i&&i.close(),(i=new WebSocket(e)).onmessage=function(e){var t=JSON.parse(e.data);t._ws&&u[t._ws]&&u[t._ws](t)}}return a(),function(o){return new Promise(function(n){6e4<(s+=1)&&(s=0);var e=s;o._ws=e;var t,r=JSON.stringify(o);!function e(){t&&(clearTimeout(t),t=null),1<i.readyState?(a(),t=setTimeout(function(){e()},3e3)):i.send(r)}(),u[e]=function(e){var t=e.theWs;e._ws=void 0,n(e),delete u[t]}})}}window.createHttpClient=t,window.createWsClient=n,e.createHttpClient=t,e.createWsClient=n,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=xhr-ws.js.map
